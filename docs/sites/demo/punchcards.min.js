(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.punchcards=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";typeof window!=="undefined"?window["crossfilter"]:typeof global!=="undefined"?global["crossfilter"]:null;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;var colormap_1=require("./colormap");var legend_1=require("./legend");var Base=function(){function Base(cf,domElemId,datekey){this.cf=cf;this.domElemId=domElemId;this.domElem=document.getElementById(this.domElemId);this.dim={};this.canDraw=false;this.marginLeft=70;this.marginRight=30;this.marginTop=50;this.marginBottom=110;this.legendWidth=80;this.ylabel="Time of day";this.title="";this.datekey=datekey||"datestr";this.colormap=new colormap_1.ColorMap;this.domElem.classList.add("punchcard-common");this.addTooltip();var that=this;window.addEventListener("resize",function(){that.onResize()})}Base.prototype.draw=function(){return this};Base.prototype.drawBox=function(){var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft;var dy=this.marginTop;this.svg.append("g").attr("class","chartbody-box").attr("transform","translate("+dx+","+dy+")").append("rect").attr("width",w).attr("height",h).attr("class","chartbody-box");return this};Base.prototype.drawChartBody=function(){var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft;var dy=this.marginTop;this.svg.append("g").attr("class","chartbody").attr("transform","translate("+dx+","+dy+")").append("rect").attr("width",w).attr("height",h).attr("class","chartbody");return this};Base.prototype.drawHorizontalAxisLabel=function(){var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft+.5*w;var dy=this.marginTop+h+.8*this.marginBottom;this.svg.append("g").attr("class","horizontal-axis-label").attr("transform","translate("+dx+","+dy+")").append("text").text(this.xlabel).attr("class","horizontal-axis-label");return this};Base.prototype.drawLegend=function(){var legend=new legend_1.Legend(this);legend.draw();return this};Base.prototype.drawSvg=function(){this.svg=d3.select(this.domElem).append("svg").attr("width",this.domElem.clientWidth).attr("height",this.domElem.clientHeight);return this};Base.prototype.drawTitle=function(){var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var dx=this.marginLeft+.5*w;var dy=.5*this.marginTop;this.svg.append("g").attr("class","title").attr("transform","translate("+dx+","+dy+")").append("text").text(this.title).attr("class","title");return this};Base.prototype.drawVerticalAxis=function(){var dx=this.marginLeft;var dy=this.domElem.clientHeight-this.marginBottom;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;this.todScale=d3.scale.linear().range([-h,0]).domain([0,24]);var todAxis=d3.svg.axis().orient("left").scale(this.todScale).tickValues([0,3,6,9,12,15,18,21,24]).innerTickSize(5).outerTickSize(0);this.svg.append("g").attr("class","vertical-axis").attr("transform","translate("+dx+","+dy+")").call(todAxis);return this};Base.prototype.drawVerticalAxisLabel=function(){var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=.3*this.marginLeft;var dy=this.marginTop+.5*h;this.svg.append("g").attr("class","vertical-axis-label").attr("transform","translate("+dx+","+dy+") rotate(-90)").append("text").text(this.ylabel).attr("class","vertical-axis-label");return this};Base.prototype.onResize=function(){var div=this.domElem;while(div.firstChild){div.removeChild(div.firstChild)}this.draw()};Base.prototype.onMouseOver=function(d){console.log(d)};Base.prototype.onClick=function(d){console.log("click:"+d)};Base.prototype.updateMinHeight=function(){var top=this.marginTop;var bottom=this.marginBottom;if(typeof top==="undefined"||top<0){top=0}if(typeof bottom==="undefined"||bottom<0){bottom=0}this.domElem.style.minHeight=(top+bottom+100).toString()+"px";return this};Base.prototype.updateMinWidth=function(){var left=this.marginLeft;var right=this.marginRight;if(typeof left==="undefined"||left<0){left=0}if(typeof right==="undefined"||right<0){right=0}this.domElem.style.minWidth=(left+right+100).toString()+"px";return this};Base.prototype.addTooltip=function(){this.tooltip=document.createElement("div");this.tooltip.classList.add("punchcard-tooltip");this.domElem.insertAdjacentElement("beforeend",this.tooltip);return this};Object.defineProperty(Base.prototype,"marginLeft",{get:function(){return this._marginLeft},set:function(marginLeft){this._marginLeft=marginLeft;this.updateMinWidth()},enumerable:true,configurable:true});Object.defineProperty(Base.prototype,"marginRight",{get:function(){return this._marginRight},set:function(marginRight){this._marginRight=marginRight;this.updateMinWidth()},enumerable:true,configurable:true});Object.defineProperty(Base.prototype,"marginTop",{get:function(){return this._marginTop},set:function(marginTop){this._marginTop=marginTop;this.updateMinHeight()},enumerable:true,configurable:true});Object.defineProperty(Base.prototype,"marginBottom",{get:function(){return this._marginBottom},set:function(marginBottom){this._marginBottom=marginBottom;this.updateMinHeight()},enumerable:true,configurable:true});Object.defineProperty(Base.prototype,"legendWidth",{get:function(){return this._legendWidth},set:function(legendWidth){var minimumWidth=50;this._legendWidth=Math.max(legendWidth,50)},enumerable:true,configurable:true});return Base}();exports.Base=Base}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./colormap":2,"./legend":5}],2:[function(require,module,exports){"use strict";var ColorMap=function(){function ColorMap(colortable){var str;var ct;if(typeof colortable==="undefined"){str="default";ct=this.expandColorTableStr(str)}else if(typeof colortable==="string"){str=undefined;ct=this.expandColorTableStr(colortable)}else if(typeof colortable==="object"){str=undefined;try{ct=colortable}catch(Error){throw new Error("Can't cast to ColorTable type")}}else{throw new Error("Undefined behavior for these input arguments.")}this.colortable=ct.sort(this.compare);var nColors=this.colortable.length;this.cLimLow=this.colortable[1].at;this.cLimHigh=this.colortable[nColors-2].at}ColorMap.prototype.compare=function(a,b){if(a.at<b.at){return-1}else if(a.at>b.at){return 1}else{return 0}};ColorMap.prototype.expandColorTableStr=function(str){var colortable;switch(str){case"default":{colortable=ColorMap.defaultColorTable;break}case"gray":{colortable=[{at:Number.NEGATIVE_INFINITY,color:[0,0,0,255]},{at:0,color:[0,0,0,0]},{at:1,color:[255,255,255,0]},{at:Number.POSITIVE_INFINITY,color:[255,255,255,255]}];break}case"empty":{colortable=[{at:Number.NEGATIVE_INFINITY,color:[0,0,0,255]},{at:Number.POSITIVE_INFINITY,color:[255,255,255,255]}];break}case"autumn":{colortable=[{at:Number.NEGATIVE_INFINITY,color:[0,0,0,255]},{at:0,color:[255,0,0,0]},{at:1,color:[255,255,0,0]},{at:Number.POSITIVE_INFINITY,color:[255,255,255,255]}];break}case"blues":{colortable=[{at:Number.NEGATIVE_INFINITY,color:[0,0,0,255]},{at:0,color:[0,0,255,0]},{at:1,color:[0,255,255,0]},{at:Number.POSITIVE_INFINITY,color:[255,255,255,255]}];break}case"summer":{colortable=[{at:Number.NEGATIVE_INFINITY,color:[0,0,0,255]},{at:0,color:[8,160,120,0]},{at:1,color:[252,252,42,0]},{at:Number.POSITIVE_INFINITY,color:[255,255,255,255]}];break}case"rainbow":{colortable=[{at:Number.NEGATIVE_INFINITY,color:[255,255,0,0]},{at:0,color:[255,255,0,0]},{at:.125,color:[255,255,0,0]},{at:.25,color:[145,255,0,0]},{at:.375,color:[0,255,54,0]},{at:.5,color:[0,179,255,0]},{at:.625,color:[10,0,255,0]},{at:.75,color:[171,0,255,0]},{at:.875,color:[255,0,159,0]},{at:1,color:[255,89,0,0]},{at:Number.POSITIVE_INFINITY,color:[255,89,0,0]}];break}default:{throw new Error("ColorMap.expandColorTableStr(): unknown case")}}return colortable};ColorMap.prototype.getColor=function(at){if(this.cLimLow===this.cLimHigh){this.cLimLow-=.5;this.cLimHigh+=.5}var atUnity=(at-this.cLimLow)/(this.cLimHigh-this.cLimLow);var nColors=this.colortable.length;var prev;var next;for(var iColor=0;iColor<nColors;iColor++){var cond1=this.colortable[iColor].at<=atUnity;var cond2=atUnity<this.colortable[iColor+1].at;if(cond1&&cond2){prev=this.colortable[iColor];next=this.colortable[iColor+1];break}}var atRelative=(atUnity-prev.at)/(next.at-prev.at);var theColor=[Math.floor(prev.color[0]+(next.color[0]-prev.color[0])*atRelative),Math.floor(prev.color[1]+(next.color[1]-prev.color[1])*atRelative),Math.floor(prev.color[2]+(next.color[2]-prev.color[2])*atRelative),255];for(var _i=0,theColor_1=theColor;_i<theColor_1.length;_i++){var channel=theColor_1[_i];if(channel<0||channel>255){throw new Error("Calculated color out of bounds.")}}return theColor};ColorMap.prototype.getColorRGB=function(at){var color;color=this.getColor(at);return"rgb("+color[0]+","+color[1]+","+color[2]+")"};ColorMap.prototype.addColor=function(color){this.colortable.push(color);this.colortable=this.colortable.sort(this.compare);return this};ColorMap.prototype.addColors=function(colors){for(var _i=0,colors_1=colors;_i<colors_1.length;_i++){var elem=colors_1[_i];this.colortable.push(elem)}this.colortable=this.colortable.sort(this.compare);return this};ColorMap.defaultColorTable=[{at:Number.NEGATIVE_INFINITY,color:[255,255,255,255]},{at:0,color:[8,106,227,0]},{at:1,color:[227,8,88,0]},{at:Number.POSITIVE_INFINITY,color:[255,255,255,255]}];return ColorMap}();exports.ColorMap=ColorMap},{}],3:[function(require,module,exports){(function(global){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};typeof window!=="undefined"?window["crossfilter"]:typeof global!=="undefined"?global["crossfilter"]:null;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;typeof window!=="undefined"?window["moment"]:typeof global!=="undefined"?global["moment"]:null;var colormap_1=require("./colormap");var date_rect_1=require("./date-rect");var DateCircle=function(_super){__extends(DateCircle,_super);function DateCircle(cf,domElemId,datekey){_super.call(this,cf,domElemId,datekey);this.xlabel="";this.title="DateCircle title";this.colormap=new colormap_1.ColorMap("rainbow");_super.prototype.defineDimensions.call(this);this.domElem.classList.remove("punchcard-date-rect");this.domElem.classList.add("punchcard-date-circle")}DateCircle.prototype.drawSymbols=function(){var that=this;var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft;var dy=this.marginTop+h;var symbolMargin={left:0,right:0,top:0,bottom:0};var wDays=moment(this.dateTo).diff(moment(this.dateFrom),"days",true);var symbolWidth=w/wDays-symbolMargin.left-symbolMargin.right;var symbolHeight=h/24-symbolMargin.top-symbolMargin.bottom;var r=Math.min(symbolWidth,symbolHeight)/2-2;var group=this.dim.dateAndHourOfDay.group();group.all().forEach(function(d){d.key=JSON.parse(d.key)});var data=group.all();var lowest=Number.POSITIVE_INFINITY;var highest=Number.NEGATIVE_INFINITY;for(var _i=0,data_1=data;_i<data_1.length;_i++){var elem=data_1[_i];if(elem.value<lowest){lowest=elem.value}if(elem.value>highest){highest=elem.value}}this.colormap.cLimLow=lowest;this.colormap.cLimHigh=highest;this.svg.append("g").attr("class","symbol").attr("transform","translate("+dx+","+dy+")").selectAll("circle.symbol").data(data).enter().append("circle").attr("class","symbol").attr("cx",function(d){return that.dateScale(new Date(d.key[that.datekey]))}).attr("cy",function(d){return that.todScale(parseInt(d.key.hourOfDay,10))+symbolMargin.top+symbolHeight/2}).attr("r",function(d){var numer=d.value-that.colormap.cLimLow;var denom=that.colormap.cLimHigh-that.colormap.cLimLow;if(denom===0){return Math.max(r,1)}else{return Math.max(r*numer/denom,1)}}).attr("fill",function(d){return that.colormap.getColorRGB(d.value)}).on("click",function(d){that.onClick(d)}).on("mouseover",function(d){that.onMouseOver(d)});return this};return DateCircle}(date_rect_1.DateRect);exports.DateCircle=DateCircle}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./colormap":2,"./date-rect":4}],4:[function(require,module,exports){(function(global){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};typeof window!=="undefined"?window["crossfilter"]:typeof global!=="undefined"?global["crossfilter"]:null;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;typeof window!=="undefined"?window["moment"]:typeof global!=="undefined"?global["moment"]:null;var base_1=require("./base");var colormap_1=require("./colormap");var DateRect=function(_super){__extends(DateRect,_super);function DateRect(cf,domElemId,datekey){_super.call(this,cf,domElemId,datekey);this.xlabel="";this.title="DateRect title";this.colormap=new colormap_1.ColorMap("default");this.defineDimensions();this.domElem.classList.add("punchcard-date-rect")}DateRect.prototype.defineDimensions=function(){var that=this;this.dim.dateAndHourOfDay=this.cf.dimension(function(d){var m;if(d.hasOwnProperty(that.datekey)){m=moment(d[that.datekey]);var obj={};obj[that.datekey]=m.format("YYYY-MM-DD");obj["hourOfDay"]=m.hour();return JSON.stringify(obj)}else{throw new Error("datekey undefined")}});this.canDraw=true;return this};DateRect.prototype.draw=function(){if(this.domElem.classList.contains("hidden")){return this}else{if(this.canDraw){_super.prototype.drawSvg.call(this);_super.prototype.drawChartBody.call(this);this.drawHorizontalAxis();_super.prototype.drawHorizontalAxisLabel.call(this);_super.prototype.drawVerticalAxis.call(this);_super.prototype.drawVerticalAxisLabel.call(this);_super.prototype.drawTitle.call(this);this.drawSymbols();_super.prototype.drawBox.call(this);_super.prototype.drawLegend.call(this)}return this}};DateRect.prototype.drawHorizontalAxis=function(){var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var dx=this.marginLeft;var dy=this.domElem.clientHeight-this.marginBottom;var firstResultDate=new Date(this.dim.dateAndHourOfDay.bottom(1)[0][this.datekey]);this.dateFrom=new Date(firstResultDate.getFullYear(),firstResultDate.getMonth(),firstResultDate.getDate(),0,0,0,0);var lastResultDate=new Date(this.dim.dateAndHourOfDay.top(1)[0][this.datekey]);this.dateTo=new Date(lastResultDate.getFullYear(),lastResultDate.getMonth(),lastResultDate.getDate(),23,59,59,999);var tickFormat;var ticks;var nHoursDiff=moment(this.dateTo).diff(moment(this.dateFrom),"hour",true);if(nHoursDiff>5*24){tickFormat=d3.time.format("%a %b %-d, %Y");ticks=7}else{tickFormat=d3.time.format("%a %b %-d, %Y");ticks=d3.time.days}this.dateScale=d3.time.scale().range([0,w]).domain([this.dateFrom,this.dateTo]);var dateAxis=d3.svg.axis().orient("bottom").scale(this.dateScale).ticks(ticks).tickFormat(tickFormat);this.svg.append("g").attr("class","horizontal-axis").attr("transform","translate("+dx+","+dy+")").call(dateAxis);this.svg.select(".horizontal-axis").selectAll("text").attr("x",-10).attr("y",0).attr("dy",".35em").style("text-anchor","end");return this};DateRect.prototype.drawSymbols=function(){var that=this;var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft;var dy=this.marginTop+h;var symbolMargin={left:0,right:0,top:0,bottom:0};var wDays=moment(this.dateTo).diff(moment(this.dateFrom),"days",true);var symbolWidth=w/wDays-symbolMargin.left-symbolMargin.right;var symbolHeight=h/24-symbolMargin.top-symbolMargin.bottom;var group=this.dim.dateAndHourOfDay.group();group.all().forEach(function(d){d.key=JSON.parse(d.key)});var data=group.all();var lowest=Number.POSITIVE_INFINITY;var highest=Number.NEGATIVE_INFINITY;for(var _i=0,data_1=data;_i<data_1.length;_i++){var elem=data_1[_i];if(elem.value<lowest){lowest=elem.value}if(elem.value>highest){highest=elem.value}}this.colormap.cLimLow=lowest;this.colormap.cLimHigh=highest;this.svg.append("g").attr("class","symbol").attr("transform","translate("+dx+","+dy+")").selectAll("rect.symbol").data(data).enter().append("rect").attr("class","symbol").attr("x",function(d){return that.dateScale(new Date(d.key[that.datekey]))}).attr("y",function(d){return that.todScale(parseInt(d.key.hourOfDay,10))}).attr("width",symbolWidth).attr("height",symbolHeight).attr("fill",function(d){return that.colormap.getColorRGB(d.value)}).on("click",function(d){that.onClick(d)}).on("mouseover",function(d){that.onMouseOver(d)});return this};DateRect.prototype.onMouseOver=function(d){console.log("x:"+this.dateScale(new Date(d.key[this.datekey]))+", y:"+this.todScale(d.key["hourOfDay"])+", count:"+d.value)};return DateRect}(base_1.Base);exports.DateRect=DateRect}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./base":1,"./colormap":2}],5:[function(require,module,exports){(function(global){"use strict";typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;var Legend=function(){function Legend(sibling){this.sibling=sibling;this.marginLeft=0;this.marginRight=60;this.marginTop=this.sibling.marginTop;this.marginBottom=this.sibling.marginBottom;this.width=this.sibling.legendWidth-this.marginLeft-this.marginRight;this.height=this.sibling.domElem.clientHeight-this.marginTop-this.marginBottom;this.title="";this.ylabel=""}Legend.prototype.draw=function(){this.drawLegendBody();this.drawHorizontalAxis();this.drawVerticalAxis();this.drawVerticalAxisLabel();this.drawTitle();this.drawSymbols();this.drawBox();return this};Legend.prototype.drawBox=function(){var dx=this.sibling.domElem.clientWidth-this.sibling.legendWidth+this.marginLeft;var dy=this.marginTop;this.sibling.svg.append("g").attr("class","punchcard-legend legendbody-box").attr("transform","translate("+dx+","+dy+")").append("rect").attr("width",this.width).attr("height",this.height).attr("class","legend legendbody-box");return this};Legend.prototype.drawHorizontalAxis=function(){var dx=this.sibling.domElem.clientWidth-this.sibling.legendWidth+this.marginLeft;var dy=this.sibling.domElem.clientHeight-this.marginBottom;var horizontalAxis=d3.svg.axis().orient("bottom").scale(this.horizontalScale).ticks(0);this.sibling.svg.append("g").attr("class","punchcard-legend horizontal-axis").attr("transform","translate("+dx+","+dy+")");return this};Legend.prototype.drawLegendBody=function(){var dx=this.sibling.domElem.clientWidth-this.sibling.legendWidth+this.marginLeft;var dy=this.sibling.domElem.clientHeight-this.marginBottom-this.height;this.sibling.svg.append("g").attr("class","punchcard-legend legendbody").attr("transform","translate("+dx+","+dy+")").append("rect").attr("width",this.width).attr("height",this.height).attr("class","legend legendbody");return this};Legend.prototype.drawSymbols=function(){var that=this;var dx=this.sibling.domElem.clientWidth-this.sibling.legendWidth+this.marginLeft;var dy=this.sibling.domElem.clientHeight-this.marginBottom;var data=[];var nRects=128;for(var iRect=0;iRect<nRects;iRect+=1){data.push({value:this.sibling.colormap.cLimLow+(iRect+.5)/nRects*(this.sibling.colormap.cLimHigh-this.sibling.colormap.cLimLow)})}var symbolHeight=this.height/nRects;this.sibling.svg.append("g").attr("class","punchcard-legend symbol").attr("transform","translate("+dx+","+dy+")").selectAll("rect.symbol").data(data).enter().append("rect").attr("class","symbol").attr("x",0).attr("y",function(d){return that.verticalScale(d.value)-.5*symbolHeight}).attr("width",this.width).attr("height",symbolHeight).attr("fill",function(d){return that.sibling.colormap.getColorRGB(d.value)});return this};Legend.prototype.drawTitle=function(){var dx=this.sibling.domElem.clientWidth-this.sibling.legendWidth+this.marginLeft+.5*this.width;var dy=this.marginTop-20;this.sibling.svg.append("g").attr("class","punchcard-legend title").attr("transform","translate("+dx+","+dy+")").append("text").text(this.title).attr("class","title");return this};Legend.prototype.drawVerticalAxis=function(){var w=this.sibling.legendWidth-this.marginLeft-this.marginRight;var h=this.sibling.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.sibling.domElem.clientWidth-this.sibling.legendWidth+this.marginLeft+w;var dy=this.sibling.domElem.clientHeight-this.marginBottom;this.verticalScale=d3.scale.linear().range([0,-h]).domain([this.sibling.colormap.cLimLow,this.sibling.colormap.cLimHigh]);var verticalAxis=d3.svg.axis().orient("right").scale(this.verticalScale).innerTickSize(5).outerTickSize(5);this.sibling.svg.append("g").attr("class","punchcard-legend vertical-axis").attr("transform","translate("+dx+","+dy+")").call(verticalAxis);return this};Legend.prototype.drawVerticalAxisLabel=function(){var h=this.sibling.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.sibling.domElem.clientWidth-this.marginRight+40;var dy=this.marginTop+.5*h;this.sibling.svg.append("g").attr("class","punchcard-legend vertical-axis-label").attr("transform","translate("+dx+","+dy+") rotate(-90)").append("text").text(this.ylabel).attr("class","legend vertical-axis-label");return this};Object.defineProperty(Legend.prototype,"marginLeft",{get:function(){return this._marginLeft},set:function(marginLeft){this._marginLeft=Math.max(marginLeft,0)},enumerable:true,configurable:true});Object.defineProperty(Legend.prototype,"marginRight",{get:function(){return this._marginRight},set:function(marginRight){this._marginRight=Math.max(marginRight,0)},enumerable:true,configurable:true});Object.defineProperty(Legend.prototype,"marginTop",{get:function(){return this._marginTop},set:function(marginTop){this._marginTop=Math.max(marginTop,this.sibling.marginTop)},enumerable:true,configurable:true});Object.defineProperty(Legend.prototype,"marginBottom",{get:function(){return this._marginBottom},set:function(marginBottom){this._marginBottom=Math.max(marginBottom,this.sibling.marginBottom)},enumerable:true,configurable:true});return Legend}();exports.Legend=Legend}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(require,module,exports){"use strict";var base_1=require("./base");exports.Base=base_1.Base;var colormap_1=require("./colormap");exports.ColorMap=colormap_1.ColorMap;var date_circle_1=require("./date-circle");exports.DateCircle=date_circle_1.DateCircle;var date_rect_1=require("./date-rect");exports.DateRect=date_rect_1.DateRect;var legend_1=require("./legend");exports.Legend=legend_1.Legend;var weekday_circle_1=require("./weekday-circle");exports.WeekdayCircle=weekday_circle_1.WeekdayCircle;var weekday_rect_1=require("./weekday-rect");exports.WeekdayRect=weekday_rect_1.WeekdayRect},{"./base":1,"./colormap":2,"./date-circle":3,"./date-rect":4,"./legend":5,"./weekday-circle":7,"./weekday-rect":8}],7:[function(require,module,exports){(function(global){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};typeof window!=="undefined"?window["crossfilter"]:typeof global!=="undefined"?global["crossfilter"]:null;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;var colormap_1=require("./colormap");var weekday_rect_1=require("./weekday-rect");var WeekdayCircle=function(_super){__extends(WeekdayCircle,_super);function WeekdayCircle(cf,domElemId,datekey){_super.call(this,cf,domElemId,datekey);this.xlabel="Day of week";this.title="WeekdayCircle title";this.colormap=new colormap_1.ColorMap("blues");_super.prototype.defineDimensions.call(this);this.domElem.classList.remove("punchcard-weekday-rect");this.domElem.classList.add("punchcard-weekday-circle")}WeekdayCircle.prototype.drawSymbols=function(){var that=this;var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft;var dy=this.marginTop+h;var symbolMargin={left:2,right:2,top:2,bottom:2};var symbolWidth=w/7-symbolMargin.left-symbolMargin.right;var symbolHeight=h/24-symbolMargin.top-symbolMargin.bottom;var r=Math.min(symbolWidth,symbolHeight)/2-2;var group=this.dim.weekdayAndHourOfDay.group();group.all().forEach(function(d){d.key=JSON.parse(d.key)});var data=group.all();var lowest=Number.POSITIVE_INFINITY;var highest=Number.NEGATIVE_INFINITY;for(var _i=0,data_1=data;_i<data_1.length;_i++){var elem=data_1[_i];if(elem.value<lowest){lowest=elem.value}if(elem.value>highest){highest=elem.value}}this.colormap.cLimLow=lowest;this.colormap.cLimHigh=highest;this.svg.append("g").attr("class","symbol").attr("transform","translate("+dx+","+dy+")").selectAll("circle.symbol").data(data).enter().append("circle").attr("class","symbol").attr("cx",function(d){return that.dayOfWeekScale(d.key["weekday"])+symbolMargin.left}).attr("cy",function(d){return that.todScale(d.key["hourOfDay"])+symbolHeight/2+symbolMargin.top}).attr("r",function(d){var numer=d.value-that.colormap.cLimLow;var denom=that.colormap.cLimHigh-that.colormap.cLimLow;if(denom===0){return Math.max(r,1)}else{return Math.max(r*numer/denom,1)}}).attr("fill",function(d){return that.colormap.getColorRGB(d.value)}).on("click",function(d){that.onClick(d)}).on("mouseover",function(d){that.onMouseOver(d)});return this};return WeekdayCircle}(weekday_rect_1.WeekdayRect);exports.WeekdayCircle=WeekdayCircle}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./colormap":2,"./weekday-rect":8}],8:[function(require,module,exports){(function(global){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};typeof window!=="undefined"?window["crossfilter"]:typeof global!=="undefined"?global["crossfilter"]:null;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;typeof window!=="undefined"?window["moment"]:typeof global!=="undefined"?global["moment"]:null;var base_1=require("./base");var colormap_1=require("./colormap");var WeekdayRect=function(_super){__extends(WeekdayRect,_super);function WeekdayRect(cf,domElemId,datekey){_super.call(this,cf,domElemId,datekey);this.marginBottom=50;this.xlabel="Day of week";this.title="WeekdayRect title";this.colormap=new colormap_1.ColorMap("summer");this.defineDimensions();this.domElem.classList.add("punchcard-weekday-rect")}WeekdayRect.prototype.defineDimensions=function(){var that=this;this.dim.weekdayAndHourOfDay=this.cf.dimension(function(d){var m;if(d.hasOwnProperty(that.datekey)){m=moment(d[that.datekey]);var obj={};obj["weekday"]=m.format("ddd");obj["hourOfDay"]=m.hour();return JSON.stringify(obj)}else{throw new Error("datekey undefined")}});this.canDraw=true;return this};WeekdayRect.prototype.draw=function(){if(this.domElem.classList.contains("hidden")){return this}else{if(this.canDraw){_super.prototype.drawSvg.call(this);_super.prototype.drawChartBody.call(this);this.drawHorizontalAxis();_super.prototype.drawHorizontalAxisLabel.call(this);_super.prototype.drawVerticalAxis.call(this);_super.prototype.drawVerticalAxisLabel.call(this);_super.prototype.drawTitle.call(this);this.drawSymbols();_super.prototype.drawBox.call(this);_super.prototype.drawLegend.call(this)}return this}};WeekdayRect.prototype.drawHorizontalAxis=function(){var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var dx=this.marginLeft;var dy=this.domElem.clientHeight-this.marginBottom;var range=[];var ndays=7;for(var _i=0,_a=[0,.5,1.5,2.5,3.5,4.5,5.5,6.5,7];_i<_a.length;_i++){var r=_a[_i];range.push(w*r/ndays)}this.dayOfWeekScale=d3.scale.ordinal().range(range).domain(["","Mon","Tue","Wed","Thu","Fri","Sat","Sun",""]);var xAxis=d3.svg.axis().orient("bottom").scale(this.dayOfWeekScale).tickValues(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]).innerTickSize(5).outerTickSize(0);this.svg.append("g").attr("class","horizontal-axis").attr("transform","translate("+dx+","+dy+")").call(xAxis);return this};WeekdayRect.prototype.drawSymbols=function(){var that=this;var w=this.domElem.clientWidth-this.marginLeft-this.marginRight-this.legendWidth;var h=this.domElem.clientHeight-this.marginTop-this.marginBottom;var dx=this.marginLeft;var dy=this.marginTop+h;var symbolMargin={left:0,right:0,top:0,bottom:0};var symbolWidth=w/7-symbolMargin.left-symbolMargin.right;var symbolHeight=h/24-symbolMargin.top-symbolMargin.bottom;var group=this.dim.weekdayAndHourOfDay.group();group.all().forEach(function(d){d.key=JSON.parse(d.key)});var data=group.all();var lowest=Number.POSITIVE_INFINITY;var highest=Number.NEGATIVE_INFINITY;for(var _i=0,data_1=data;_i<data_1.length;_i++){var elem=data_1[_i];if(elem.value<lowest){lowest=elem.value}if(elem.value>highest){highest=elem.value}}this.colormap.cLimLow=lowest;this.colormap.cLimHigh=highest;this.svg.append("g").attr("class","symbol").attr("transform","translate("+dx+","+dy+")").selectAll("rect.symbol").data(data).enter().append("rect").attr("class","symbol").attr("x",function(d){return that.dayOfWeekScale(d.key["weekday"])-symbolWidth/2}).attr("y",function(d){return that.todScale(d.key["hourOfDay"])}).attr("width",symbolWidth).attr("height",symbolHeight).attr("fill",function(d){return that.colormap.getColorRGB(d.value)}).on("click",function(d){that.onClick(d)}).on("mouseover",function(d){that.onMouseOver(d)});return this};WeekdayRect.prototype.onMouseOver=function(d){console.log("x:"+this.dayOfWeekScale(d.key["weekday"])+", y:"+this.todScale(d.key["hourOfDay"])+", count:"+d.value)};return WeekdayRect}(base_1.Base);exports.WeekdayRect=WeekdayRect}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./base":1,"./colormap":2}]},{},[6])(6)});
//# sourceMappingURL=punchcards.min.js.map